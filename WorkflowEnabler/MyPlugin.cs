using System;
using System.Collections.Generic;
using System.ComponentModel.Composition;
using System.IO;
using System.Linq;
using System.Reflection;
using XrmToolBox.Extensibility;
using XrmToolBox.Extensibility.Interfaces;

namespace WorkflowEnabler
{
    // Do not forget to update version number and author (company attribute) in AssemblyInfo.cs class
  
    [Export(typeof(IXrmToolBoxPlugin)),
      ExportMetadata("Name", "Workflow Enabler"),
      ExportMetadata("Description", "Manage your Dynamics 365 workflows quickly and easily. Activate, deactivate, filter, search, and export workflows from a single interface."),
      ExportMetadata("SmallImageBase64", "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"),
      ExportMetadata("BigImageBase64", "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"),
      ExportMetadata("BackgroundColor", "Lavender"),
      ExportMetadata("PrimaryFontColor", "Black"),
      ExportMetadata("SecondaryFontColor", "Gray")]
    public class MyPlugin : PluginBase
    {
        public override IXrmToolBoxPluginControl GetControl()
        {
            return new MyPluginControl();
        }

        /// <summary>
        /// Constructor 
        /// </summary>
        public MyPlugin()
        {
            // If you have external assemblies that you need to load, uncomment the following to 
            // hook into the event that will fire when an Assembly fails to resolve
            // AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(AssemblyResolveEventHandler);
        }

        /// <summary>
        /// Event fired by CLR when an assembly reference fails to load
        /// Assumes that related assemblies will be loaded from a subfolder named the same as the Plugin
        /// For example, a folder named Sample.XrmToolBox.MyPlugin 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="args"></param>
        /// <returns></returns>
        private Assembly AssemblyResolveEventHandler(object sender, ResolveEventArgs args)
        {
            Assembly loadAssembly = null;
            Assembly currAssembly = Assembly.GetExecutingAssembly();

            // base name of the assembly that failed to resolve
            var argName = args.Name.Substring(0, args.Name.IndexOf(","));

            // check to see if the failing assembly is one that we reference.
            List<AssemblyName> refAssemblies = currAssembly.GetReferencedAssemblies().ToList();
            var refAssembly = refAssemblies.Where(a => a.Name == argName).FirstOrDefault();

            // if the current unresolved assembly is referenced by our plugin, attempt to load
            if (refAssembly != null)
            {
                // load from the path to this plugin assembly, not host executable
                string dir = Path.GetDirectoryName(currAssembly.Location).ToLower();
                string folder = Path.GetFileNameWithoutExtension(currAssembly.Location);
                dir = Path.Combine(dir, folder);

                var assmbPath = Path.Combine(dir, $"{argName}.dll");

                if (File.Exists(assmbPath))
                {
                    loadAssembly = Assembly.LoadFrom(assmbPath);
                }
                else
                {
                    throw new FileNotFoundException($"Unable to locate dependency: {assmbPath}");
                }
            }

            return loadAssembly;
        }
    }
}